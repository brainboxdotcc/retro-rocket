<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Retro Rocket OS: src/idt.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Retro Rocket OS
   </div>
   <div id="projectbrief">BASIC-Powered Operating System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('idt_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">idt.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="kernel_8h.html">kernel.h</a>&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a6b115109e4a0d3c5fb6252d091e86bfe"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a6b115109e4a0d3c5fb6252d091e86bfe">PIC1</a>&#160;&#160;&#160;0x20</td></tr>
<tr class="separator:a6b115109e4a0d3c5fb6252d091e86bfe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac90003f52c8d736193efc954ece08e58"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#ac90003f52c8d736193efc954ece08e58">PIC2</a>&#160;&#160;&#160;0xA0</td></tr>
<tr class="separator:ac90003f52c8d736193efc954ece08e58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1ba81484ab03e762d2e09f851c0901f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#ad1ba81484ab03e762d2e09f851c0901f">PIC1_COMMAND</a>&#160;&#160;&#160;<a class="el" href="idt_8c.html#a6b115109e4a0d3c5fb6252d091e86bfe">PIC1</a></td></tr>
<tr class="separator:ad1ba81484ab03e762d2e09f851c0901f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af27e966ec947ca1172f30ae301c5f24b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#af27e966ec947ca1172f30ae301c5f24b">PIC1_DATA</a>&#160;&#160;&#160;(<a class="el" href="idt_8c.html#a6b115109e4a0d3c5fb6252d091e86bfe">PIC1</a>+1)</td></tr>
<tr class="separator:af27e966ec947ca1172f30ae301c5f24b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11d8793812c9d340e9a64cce26ee0570"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a11d8793812c9d340e9a64cce26ee0570">PIC2_COMMAND</a>&#160;&#160;&#160;<a class="el" href="idt_8c.html#ac90003f52c8d736193efc954ece08e58">PIC2</a></td></tr>
<tr class="separator:a11d8793812c9d340e9a64cce26ee0570"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6d3b9f6f427357310896adf176145f1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#ab6d3b9f6f427357310896adf176145f1">PIC2_DATA</a>&#160;&#160;&#160;(<a class="el" href="idt_8c.html#ac90003f52c8d736193efc954ece08e58">PIC2</a>+1)</td></tr>
<tr class="separator:ab6d3b9f6f427357310896adf176145f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a170d8eebdb48c16cfcd60cbd46760cb2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a170d8eebdb48c16cfcd60cbd46760cb2">PIC_EOI</a>&#160;&#160;&#160;0x20</td></tr>
<tr class="separator:a170d8eebdb48c16cfcd60cbd46760cb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a286dc251f3d73c08e08a53a4696f31ef"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a286dc251f3d73c08e08a53a4696f31ef">ICW1_INIT</a>&#160;&#160;&#160;0x10</td></tr>
<tr class="separator:a286dc251f3d73c08e08a53a4696f31ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a964d12193d2b36e8a7ec7fa57438e313"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a964d12193d2b36e8a7ec7fa57438e313">ICW1_ICW4</a>&#160;&#160;&#160;0x01</td></tr>
<tr class="separator:a964d12193d2b36e8a7ec7fa57438e313"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42803c5ddcec9e120a6dbf7bc5c1b7af"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a42803c5ddcec9e120a6dbf7bc5c1b7af">ICW4_8086</a>&#160;&#160;&#160;0x01</td></tr>
<tr class="separator:a42803c5ddcec9e120a6dbf7bc5c1b7af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3411d302a8565dc77c69a39fa06785c7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a3411d302a8565dc77c69a39fa06785c7">MSI_VECTORS</a>&#160;&#160;&#160;256</td></tr>
<tr class="separator:a3411d302a8565dc77c69a39fa06785c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2cb32912a0dad9683fdd07f3288c733"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#ae2cb32912a0dad9683fdd07f3288c733">FIRST_MSI_VECTOR</a>&#160;&#160;&#160;64</td></tr>
<tr class="separator:ae2cb32912a0dad9683fdd07f3288c733"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ce112d10224ac09bee291b79d867d89"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a7ce112d10224ac09bee291b79d867d89">MSI_WORDS</a>&#160;&#160;&#160;(<a class="el" href="idt_8c.html#a3411d302a8565dc77c69a39fa06785c7">MSI_VECTORS</a> / 64)</td></tr>
<tr class="separator:a7ce112d10224ac09bee291b79d867d89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00088b2d7f9e171802c966750909e6f6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a00088b2d7f9e171802c966750909e6f6">MSI_RESERVED_MASK</a>&#160;&#160;&#160;((<a class="el" href="idt_8c.html#ae2cb32912a0dad9683fdd07f3288c733">FIRST_MSI_VECTOR</a> == 64) ? ~0ULL : ((1ULL &lt;&lt; <a class="el" href="idt_8c.html#ae2cb32912a0dad9683fdd07f3288c733">FIRST_MSI_VECTOR</a>) - 1ULL))</td></tr>
<tr class="separator:a00088b2d7f9e171802c966750909e6f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa97e24fea4daabae6b4e5d534ac8066d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#aa97e24fea4daabae6b4e5d534ac8066d">__attribute__</a> ((aligned(16)))</td></tr>
<tr class="separator:aa97e24fea4daabae6b4e5d534ac8066d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6024a6afd45d551f30762531766a185a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a6024a6afd45d551f30762531766a185a">io_wait</a> ()</td></tr>
<tr class="memdesc:a6024a6afd45d551f30762531766a185a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Small I/O delay for hardware synchronisation.  <a href="idt_8c.html#a6024a6afd45d551f30762531766a185a">More...</a><br /></td></tr>
<tr class="separator:a6024a6afd45d551f30762531766a185a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3dcd40ab20d43c39d9c85774f4d5e7c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#af3dcd40ab20d43c39d9c85774f4d5e7c">pic_remap</a> (int offset1, int offset2)</td></tr>
<tr class="separator:af3dcd40ab20d43c39d9c85774f4d5e7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a617b42efbd15ef9c6d4e7b467c59317e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a617b42efbd15ef9c6d4e7b467c59317e">pic_disable</a> ()</td></tr>
<tr class="separator:a617b42efbd15ef9c6d4e7b467c59317e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acec4df702487e44b82b31748a089ad9c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#acec4df702487e44b82b31748a089ad9c">pic_enable</a> ()</td></tr>
<tr class="separator:acec4df702487e44b82b31748a089ad9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac58b11f9cfbfe9217a7e9a256f6a1038"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#ac58b11f9cfbfe9217a7e9a256f6a1038">pic_eoi</a> (int irq)</td></tr>
<tr class="memdesc:ac58b11f9cfbfe9217a7e9a256f6a1038"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send End-of-Interrupt (EOI) to the PIC.  <a href="idt_8c.html#ac58b11f9cfbfe9217a7e9a256f6a1038">More...</a><br /></td></tr>
<tr class="separator:ac58b11f9cfbfe9217a7e9a256f6a1038"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35fe413107af682030ab7a4b6dff19b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a35fe413107af682030ab7a4b6dff19b8">init_idt</a> ()</td></tr>
<tr class="memdesc:a35fe413107af682030ab7a4b6dff19b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise the IDT and enable interrupts.  <a href="idt_8c.html#a35fe413107af682030ab7a4b6dff19b8">More...</a><br /></td></tr>
<tr class="separator:a35fe413107af682030ab7a4b6dff19b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a999453d510cd4178931cf51d7ba0ec2f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a999453d510cd4178931cf51d7ba0ec2f">alloc_msi_vector</a> (uint8_t cpu)</td></tr>
<tr class="memdesc:a999453d510cd4178931cf51d7ba0ec2f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a free MSI interrupt vector on a given CPU.  <a href="idt_8c.html#a999453d510cd4178931cf51d7ba0ec2f">More...</a><br /></td></tr>
<tr class="separator:a999453d510cd4178931cf51d7ba0ec2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3567555043c64e8065fbe9f47d0dd894"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a3567555043c64e8065fbe9f47d0dd894">free_msi_vector</a> (uint8_t cpu, int vec)</td></tr>
<tr class="memdesc:a3567555043c64e8065fbe9f47d0dd894"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a previously allocated MSI interrupt vector on a given CPU.  <a href="idt_8c.html#a3567555043c64e8065fbe9f47d0dd894">More...</a><br /></td></tr>
<tr class="separator:a3567555043c64e8065fbe9f47d0dd894"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65a15cc23a7bd19af939b9ff5b7bd2ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a65a15cc23a7bd19af939b9ff5b7bd2ad">load_ap_shared_idt</a> ()</td></tr>
<tr class="memdesc:a65a15cc23a7bd19af939b9ff5b7bd2ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load the shared IDT and enable interrupts on an Application Processor (AP).  <a href="idt_8c.html#a65a15cc23a7bd19af939b9ff5b7bd2ad">More...</a><br /></td></tr>
<tr class="separator:a65a15cc23a7bd19af939b9ff5b7bd2ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a662d60372c27399d687c8f80f33a99c4"><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="idt_8c.html#a662d60372c27399d687c8f80f33a99c4">msi_bitmap</a> [<a class="el" href="idt_8h.html#a87cbc7cff225b4ad63d67d47c21f933f">MAX_CPUS</a>][(256/64)]</td></tr>
<tr class="separator:a662d60372c27399d687c8f80f33a99c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ae2cb32912a0dad9683fdd07f3288c733"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2cb32912a0dad9683fdd07f3288c733">&#9670;&nbsp;</a></span>FIRST_MSI_VECTOR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FIRST_MSI_VECTOR&#160;&#160;&#160;64</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a964d12193d2b36e8a7ec7fa57438e313"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a964d12193d2b36e8a7ec7fa57438e313">&#9670;&nbsp;</a></span>ICW1_ICW4</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ICW1_ICW4&#160;&#160;&#160;0x01</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a286dc251f3d73c08e08a53a4696f31ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a286dc251f3d73c08e08a53a4696f31ef">&#9670;&nbsp;</a></span>ICW1_INIT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ICW1_INIT&#160;&#160;&#160;0x10</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a42803c5ddcec9e120a6dbf7bc5c1b7af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42803c5ddcec9e120a6dbf7bc5c1b7af">&#9670;&nbsp;</a></span>ICW4_8086</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ICW4_8086&#160;&#160;&#160;0x01</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a00088b2d7f9e171802c966750909e6f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00088b2d7f9e171802c966750909e6f6">&#9670;&nbsp;</a></span>MSI_RESERVED_MASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MSI_RESERVED_MASK&#160;&#160;&#160;((<a class="el" href="idt_8c.html#ae2cb32912a0dad9683fdd07f3288c733">FIRST_MSI_VECTOR</a> == 64) ? ~0ULL : ((1ULL &lt;&lt; <a class="el" href="idt_8c.html#ae2cb32912a0dad9683fdd07f3288c733">FIRST_MSI_VECTOR</a>) - 1ULL))</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3411d302a8565dc77c69a39fa06785c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3411d302a8565dc77c69a39fa06785c7">&#9670;&nbsp;</a></span>MSI_VECTORS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MSI_VECTORS&#160;&#160;&#160;256</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7ce112d10224ac09bee291b79d867d89"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ce112d10224ac09bee291b79d867d89">&#9670;&nbsp;</a></span>MSI_WORDS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MSI_WORDS&#160;&#160;&#160;(<a class="el" href="idt_8c.html#a3411d302a8565dc77c69a39fa06785c7">MSI_VECTORS</a> / 64)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a6b115109e4a0d3c5fb6252d091e86bfe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b115109e4a0d3c5fb6252d091e86bfe">&#9670;&nbsp;</a></span>PIC1</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIC1&#160;&#160;&#160;0x20</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad1ba81484ab03e762d2e09f851c0901f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1ba81484ab03e762d2e09f851c0901f">&#9670;&nbsp;</a></span>PIC1_COMMAND</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIC1_COMMAND&#160;&#160;&#160;<a class="el" href="idt_8c.html#a6b115109e4a0d3c5fb6252d091e86bfe">PIC1</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af27e966ec947ca1172f30ae301c5f24b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af27e966ec947ca1172f30ae301c5f24b">&#9670;&nbsp;</a></span>PIC1_DATA</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIC1_DATA&#160;&#160;&#160;(<a class="el" href="idt_8c.html#a6b115109e4a0d3c5fb6252d091e86bfe">PIC1</a>+1)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac90003f52c8d736193efc954ece08e58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac90003f52c8d736193efc954ece08e58">&#9670;&nbsp;</a></span>PIC2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIC2&#160;&#160;&#160;0xA0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a11d8793812c9d340e9a64cce26ee0570"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11d8793812c9d340e9a64cce26ee0570">&#9670;&nbsp;</a></span>PIC2_COMMAND</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIC2_COMMAND&#160;&#160;&#160;<a class="el" href="idt_8c.html#ac90003f52c8d736193efc954ece08e58">PIC2</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab6d3b9f6f427357310896adf176145f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6d3b9f6f427357310896adf176145f1">&#9670;&nbsp;</a></span>PIC2_DATA</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIC2_DATA&#160;&#160;&#160;(<a class="el" href="idt_8c.html#ac90003f52c8d736193efc954ece08e58">PIC2</a>+1)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a170d8eebdb48c16cfcd60cbd46760cb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a170d8eebdb48c16cfcd60cbd46760cb2">&#9670;&nbsp;</a></span>PIC_EOI</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIC_EOI&#160;&#160;&#160;0x20</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aa97e24fea4daabae6b4e5d534ac8066d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa97e24fea4daabae6b4e5d534ac8066d">&#9670;&nbsp;</a></span>__attribute__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct____attribute____.html">__attribute__</a> </td>
          <td>(</td>
          <td class="paramtype">(aligned(16))&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a999453d510cd4178931cf51d7ba0ec2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a999453d510cd4178931cf51d7ba0ec2f">&#9670;&nbsp;</a></span>alloc_msi_vector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int alloc_msi_vector </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>cpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate a free MSI interrupt vector on a given CPU. </p>
<p>Allocates an IDT vector in the range 64–255 for use with Message Signalled Interrupts (MSI/MSI-X), associated with the specified Local APIC ID.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cpu</td><td>Logical CPU ID of the target CPU.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Vector number (64–255) on success, -1 if no free vector is available on that CPU.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>After allocation, the driver must program the device’s MSI/MSI-X capability structure with the returned vector and Local APIC ID, and register an interrupt handler for the vector on the specified CPU. </dd></dl>

</div>
</div>
<a id="a3567555043c64e8065fbe9f47d0dd894"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3567555043c64e8065fbe9f47d0dd894">&#9670;&nbsp;</a></span>free_msi_vector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_msi_vector </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>cpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>vec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free a previously allocated MSI interrupt vector on a given CPU. </p>
<p>Marks the given MSI vector as available for reuse on the specified Local APIC ID.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cpu</td><td>Logical CPU ID of the CPU that the vector belongs to. </td></tr>
    <tr><td class="paramname">vec</td><td>The MSI vector to free (64–255).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>Behaviour is undefined if freeing a vector that was never allocated on the given CPU, or is still in use.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Drivers should call this during teardown to avoid leaking interrupt vectors on that CPU. </dd></dl>

</div>
</div>
<a id="a35fe413107af682030ab7a4b6dff19b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35fe413107af682030ab7a4b6dff19b8">&#9670;&nbsp;</a></span>init_idt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_idt </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialise the IDT and enable interrupts. </p>
<p>Sets up the full 256-entry Interrupt Descriptor Table (IDT), remaps or disables the legacy PIC depending on configuration, configures the PIT to 50Hz (if APIC timer is not used), and loads the IDT register. CPU interrupts are enabled at the end.</p>
<dl class="section note"><dt>Note</dt><dd>Called once during kernel bootstrap. Drivers must not call this directly. </dd></dl>

</div>
</div>
<a id="a6024a6afd45d551f30762531766a185a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6024a6afd45d551f30762531766a185a">&#9670;&nbsp;</a></span>io_wait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_wait </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Small I/O delay for hardware synchronisation. </p>
<p>Performs an I/O write to port 0x80 to allow hardware devices (such as the PIC) time to settle after reprogramming.</p>
<dl class="section note"><dt>Note</dt><dd>Typically only needed by low-level kernel code. Most drivers do not need to call this. </dd></dl>

</div>
</div>
<a id="a65a15cc23a7bd19af939b9ff5b7bd2ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65a15cc23a7bd19af939b9ff5b7bd2ad">&#9670;&nbsp;</a></span>load_ap_shared_idt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void load_ap_shared_idt </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load the shared IDT and enable interrupts on an Application Processor (AP). </p>
<p>This function loads the global Interrupt Descriptor Table (IDT) pointer into the AP's IDTR register using the <code>lidt</code> instruction. After the IDT is loaded, it enables external interrupts via <code>sti</code> (wrapped by <a class="el" href="io_8h.html#a46886fcdf5af666afe41598958dc0bdd" title="Enable maskable hardware interrupts.">interrupts_on()</a>).</p>
<p>It is typically called during AP startup before entering the scheduler loop, ensuring that the AP can handle interrupts using the same IDT as the BSP.</p>
<dl class="section note"><dt>Note</dt><dd>All APs share the same IDT (idt64) in this design. </dd></dl>
<dl class="section see"><dt>See also</dt><dd>lidt, <a class="el" href="io_8h.html#a46886fcdf5af666afe41598958dc0bdd" title="Enable maskable hardware interrupts.">interrupts_on</a> </dd></dl>

</div>
</div>
<a id="a617b42efbd15ef9c6d4e7b467c59317e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a617b42efbd15ef9c6d4e7b467c59317e">&#9670;&nbsp;</a></span>pic_disable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pic_disable </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="acec4df702487e44b82b31748a089ad9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acec4df702487e44b82b31748a089ad9c">&#9670;&nbsp;</a></span>pic_enable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pic_enable </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac58b11f9cfbfe9217a7e9a256f6a1038"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac58b11f9cfbfe9217a7e9a256f6a1038">&#9670;&nbsp;</a></span>pic_eoi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pic_eoi </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>irq</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send End-of-Interrupt (EOI) to the PIC. </p>
<p>Notifies the PIC(s) that interrupt handling has finished. For IRQs &gt;= 8, signals both slave and master PICs.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">irq</td><td>The IRQ line number (0–15).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Normally issued automatically by the kernel after invoking registered handlers. Only call directly when writing low-level PIC-specific code. </dd></dl>

</div>
</div>
<a id="af3dcd40ab20d43c39d9c85774f4d5e7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3dcd40ab20d43c39d9c85774f4d5e7c">&#9670;&nbsp;</a></span>pic_remap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pic_remap </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offset1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offset2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a662d60372c27399d687c8f80f33a99c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a662d60372c27399d687c8f80f33a99c4">&#9670;&nbsp;</a></span>msi_bitmap</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t msi_bitmap[<a class="el" href="idt_8h.html#a87cbc7cff225b4ad63d67d47c21f933f">MAX_CPUS</a>][(256/64)]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    [0 ... <a class="code" href="idt_8h.html#a87cbc7cff225b4ad63d67d47c21f933f">MAX_CPUS</a>-1] = {  (( 64  == 64) ? ~0ULL : ((1ULL &lt;&lt;  64 ) - 1ULL)) , 0, 0, 0 }</div>
<div class="line">}</div>
<div class="ttc" id="aidt_8h_html_a87cbc7cff225b4ad63d67d47c21f933f"><div class="ttname"><a href="idt_8h.html#a87cbc7cff225b4ad63d67d47c21f933f">MAX_CPUS</a></div><div class="ttdeci">#define MAX_CPUS</div><div class="ttdef"><b>Definition:</b> idt.h:45</div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="idt_8c.html">idt.c</a></li>
    <li class="footer">Generated on Sat Sep 6 2025 02:11:13 for Retro Rocket OS by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
