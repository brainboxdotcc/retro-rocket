<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Retro Rocket OS: helpers.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rr.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Retro Rocket OS
   </div>
   <div id="projectbrief">BASIC-Powered Operating System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('fs_2retrofs_2helpers_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">fs/retrofs/helpers.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7aa41789c8d357a0e0d8d83bc0ff7580"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs_2retrofs_2helpers_8c.html#a7aa41789c8d357a0e0d8d83bc0ff7580">rfs_read_device</a> (<a class="el" href="structrfs__t.html">rfs_t</a> *rfs, uint64_t start_sectors, uint64_t size_bytes, void *<a class="el" href="input_8c.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>)</td></tr>
<tr class="memdesc:a7aa41789c8d357a0e0d8d83bc0ff7580"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read raw sectors from the underlying device.  <a href="fs_2retrofs_2helpers_8c.html#a7aa41789c8d357a0e0d8d83bc0ff7580">More...</a><br /></td></tr>
<tr class="separator:a7aa41789c8d357a0e0d8d83bc0ff7580"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af68c31483d4d81b83304d6aabf979a39"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs_2retrofs_2helpers_8c.html#af68c31483d4d81b83304d6aabf979a39">rfs_write_device</a> (<a class="el" href="structrfs__t.html">rfs_t</a> *rfs, uint64_t start_sectors, uint64_t size_bytes, const void *<a class="el" href="input_8c.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>)</td></tr>
<tr class="memdesc:af68c31483d4d81b83304d6aabf979a39"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write raw sectors to the underlying device.  <a href="fs_2retrofs_2helpers_8c.html#af68c31483d4d81b83304d6aabf979a39">More...</a><br /></td></tr>
<tr class="separator:af68c31483d4d81b83304d6aabf979a39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaab69cffd8e814e0b6b83d6fededdff9"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs_2retrofs_2helpers_8c.html#aaab69cffd8e814e0b6b83d6fededdff9">rfs_clear_device</a> (<a class="el" href="structrfs__t.html">rfs_t</a> *rfs, uint64_t start_sectors, uint64_t size_bytes)</td></tr>
<tr class="memdesc:aaab69cffd8e814e0b6b83d6fededdff9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hint to the storage driver that we can clear blocks on the device, e.g. TRIM or similar.  <a href="fs_2retrofs_2helpers_8c.html#aaab69cffd8e814e0b6b83d6fededdff9">More...</a><br /></td></tr>
<tr class="separator:aaab69cffd8e814e0b6b83d6fededdff9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35fd4da8867e505b24f85c865851deed"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs_2retrofs_2helpers_8c.html#a35fd4da8867e505b24f85c865851deed">rfs_locate_entry</a> (<a class="el" href="structrfs__t.html">rfs_t</a> *info, <a class="el" href="structfs__tree__t.html">fs_tree_t</a> *tree, const char *<a class="el" href="partition_8h.html#a01407fb88d72f1334e349771e1a3a44d">name</a>, uint64_t *out_sector, size_t *out_index, <a class="el" href="structrfs__directory__entry__inner__t.html">rfs_directory_entry_inner_t</a> *out_entry_copy)</td></tr>
<tr class="memdesc:a35fd4da8867e505b24f85c865851deed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Locate a directory entry by name within a given directory.  <a href="fs_2retrofs_2helpers_8c.html#a35fd4da8867e505b24f85c865851deed">More...</a><br /></td></tr>
<tr class="separator:a35fd4da8867e505b24f85c865851deed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add03ce7aa17db9f02d70ddd7e039582a"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs_2retrofs_2helpers_8c.html#add03ce7aa17db9f02d70ddd7e039582a">rfs_get_free_space</a> (void *fs)</td></tr>
<tr class="memdesc:add03ce7aa17db9f02d70ddd7e039582a"><td class="mdescLeft">&#160;</td><td class="mdescRight">VFS endpoint to get free space on the filesystem in bytes.  <a href="fs_2retrofs_2helpers_8c.html#add03ce7aa17db9f02d70ddd7e039582a">More...</a><br /></td></tr>
<tr class="separator:add03ce7aa17db9f02d70ddd7e039582a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5572af757f45e082f138cf773410f61b"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs_2retrofs_2helpers_8c.html#a5572af757f45e082f138cf773410f61b">rfs_get_used_bytes</a> (<a class="el" href="structrfs__t.html">rfs_t</a> *info)</td></tr>
<tr class="memdesc:a5572af757f45e082f138cf773410f61b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the exact number of bytes currently in use on the volume.  <a href="fs_2retrofs_2helpers_8c.html#a5572af757f45e082f138cf773410f61b">More...</a><br /></td></tr>
<tr class="separator:a5572af757f45e082f138cf773410f61b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="aaab69cffd8e814e0b6b83d6fededdff9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaab69cffd8e814e0b6b83d6fededdff9">&#9670;&nbsp;</a></span>rfs_clear_device()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool rfs_clear_device </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrfs__t.html">rfs_t</a> *&#160;</td>
          <td class="paramname"><em>rfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>start_sectors</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>size_bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hint to the storage driver that we can clear blocks on the device, e.g. TRIM or similar. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rfs</td><td>Filesystem context </td></tr>
    <tr><td class="paramname">start_sectors</td><td>Sector index (relative to the filesystem start) </td></tr>
    <tr><td class="paramname">size_bytes</td><td>Number of bytes to write (must be a multiple of sector size). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true on success, false on error or not supported </dd></dl>

</div>
</div>
<a id="add03ce7aa17db9f02d70ddd7e039582a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add03ce7aa17db9f02d70ddd7e039582a">&#9670;&nbsp;</a></span>rfs_get_free_space()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t rfs_get_free_space </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>VFS endpoint to get free space on the filesystem in bytes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td><a class="el" href="structfs__tree__t.html" title="Used internally by filesystem.c to cache directories to RAM.">fs_tree_t</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>free space in bytes </dd></dl>

</div>
</div>
<a id="a5572af757f45e082f138cf773410f61b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5572af757f45e082f138cf773410f61b">&#9670;&nbsp;</a></span>rfs_get_used_bytes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t rfs_get_used_bytes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrfs__t.html">rfs_t</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate the exact number of bytes currently in use on the volume. </p>
<p>This function uses the in-memory Level-1 free‚Äêsector counters built by <a class="el" href="retrofs_8h.html#a68bfd092abff119ace6499907853609a" title="Build L1/L2 cache structures from the on-disk free space map.">rfs_build_level_caches()</a> to determine usage precisely. It sums the free sector counts for all L1 groups, converts the total to bytes, and subtracts from the total volume size. The result is exact as long as the L1 cache is up to date.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">info</td><td>Pointer to the RetroFS volume context (must have valid L1 cache). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Number of bytes currently allocated/used on the volume.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>If the volume was not cleanly unmounted, ensure the L1 cache has been rebuilt from the on-disk free space map before calling this function. </dd></dl>

</div>
</div>
<a id="a35fd4da8867e505b24f85c865851deed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35fd4da8867e505b24f85c865851deed">&#9670;&nbsp;</a></span>rfs_locate_entry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool rfs_locate_entry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrfs__t.html">rfs_t</a> *&#160;</td>
          <td class="paramname"><em>info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfs__tree__t.html">fs_tree_t</a> *&#160;</td>
          <td class="paramname"><em>tree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>out_sector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>out_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrfs__directory__entry__inner__t.html">rfs_directory_entry_inner_t</a> *&#160;</td>
          <td class="paramname"><em>out_entry_copy</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Locate a directory entry by name within a given directory. </p>
<p>Searches the specified directory (including any continuation blocks) for an entry whose filename matches <code>name</code>. If found, returns its on-disk location and a copy of the directory entry structure.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">info</td><td>Filesystem context (RetroFS instance). </td></tr>
    <tr><td class="paramname">tree</td><td>VFS tree node representing the directory to search. </td></tr>
    <tr><td class="paramname">name</td><td>Filename to look up (null-terminated string). </td></tr>
    <tr><td class="paramname">out_sector</td><td>Receives the sector number containing the entry. </td></tr>
    <tr><td class="paramname">out_index</td><td>Receives the index of the entry within that sector. </td></tr>
    <tr><td class="paramname">out_entry_copy</td><td>Receives a copy of the on-disk entry. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> if the entry was found, <code>false</code> otherwise. </dd></dl>

</div>
</div>
<a id="a7aa41789c8d357a0e0d8d83bc0ff7580"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7aa41789c8d357a0e0d8d83bc0ff7580">&#9670;&nbsp;</a></span>rfs_read_device()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool rfs_read_device </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrfs__t.html">rfs_t</a> *&#160;</td>
          <td class="paramname"><em>rfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>start_sectors</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>size_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read raw sectors from the underlying device. </p>
<p>Low-level helper for retrieving a contiguous range of sectors from the block device.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rfs</td><td>Filesystem context. </td></tr>
    <tr><td class="paramname">start_sectors</td><td>Sector index (relative to filesystem start). </td></tr>
    <tr><td class="paramname">size_bytes</td><td>Number of bytes to read (must be a multiple of sector size). </td></tr>
    <tr><td class="paramname">buffer</td><td>Destination buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true on success, false on error. </dd></dl>

</div>
</div>
<a id="af68c31483d4d81b83304d6aabf979a39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af68c31483d4d81b83304d6aabf979a39">&#9670;&nbsp;</a></span>rfs_write_device()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool rfs_write_device </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrfs__t.html">rfs_t</a> *&#160;</td>
          <td class="paramname"><em>rfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>start_sectors</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>size_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write raw sectors to the underlying device. </p>
<p>Low-level helper for storing a contiguous range of sectors to the block device.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rfs</td><td>Filesystem context. </td></tr>
    <tr><td class="paramname">start_sectors</td><td>Sector index (relative to filesystem start). </td></tr>
    <tr><td class="paramname">size_bytes</td><td>Number of bytes to write (must be a multiple of sector size). </td></tr>
    <tr><td class="paramname">buffer</td><td>Source buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true on success, false on error. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_7d71b6c457a61cbf03a04bfdc57b6110.html">fs</a></li><li class="navelem"><a class="el" href="dir_1eabc77e0412af1f7cc913afe8cd3275.html">retrofs</a></li><li class="navelem"><a class="el" href="fs_2retrofs_2helpers_8c.html">helpers.c</a></li>
    <li class="footer">Generated on Mon Sep 8 2025 16:09:35 for Retro Rocket OS by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
